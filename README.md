# GemMod

> Алгоритм решения вдохновлен [этой](https://docs.taichi-lang.org/blog/acclerate-collision-detection-with-taichi)
> статьей.

## Преамбула
> Концепция приложения -- “Наблюдение за моими котами”

Все коты могут быть разделены на две категории:
* **любимые**;
* **остальные**.

Пользователь может выбрать количество **любимых** котов. Если **любимых** котов ноль, то все коты считаются **остальными**.
>Приложение нацелена на то, что пользователь симулирует владение котами. Поэтому подразумевается, выбор хотя бы одного любимого кота.
>* Но дабы не ограничивать пользователя, добавлена возможность выбрать 0 любимых котов, хотя этот вариант является "*экспериментальным*". И команда разработчиков не несет ответственности за совместимость фич в этом случае.

## Взаимодействие

Взаимодействие котов между собой определяется по следующим правилам:

1. Если два кота находятся на расстоянии не превышающем `RADIUS_0`, то они пытаются начать драку с вероятностью 1.

2. Если два кота находятся на расстоянии `RADIUS_1`, там, что `RADIUS_1 > RADIUS_0`, они начинают шипеть с вероятностью
   обратно пропорциональной квадрату расстояния между ними.

3. Если вокруг кота нет соперников он перемещается согласно текущему правилу.

Перемещение котов картой размера `PLATE_WIDTH` на `PLATE_HEIGHT`

## Фичи

 > Все фичи не зависят друг от друга и могут включаться и отключаться независимо друг от друга

### Фичи первой части
1. Возможность использования различных функций расстояния:
    * `EUCLIDEAN_DISTANCE`
    * `MANHATTAN_DISTANCE`
    * `CHEBYSHEV_DISTANCE`

2. Поддержка до `5*10^5` котов с минимальной возможно частотой `7 FPS`

    * **ВАЖНО: эти показатели сильно зависят от:**
        * размеров кота и радиуса его взаимодействия _(`RADIUS_1`, `MOVE_RADIUS`)_
        * от машины, на которой это запускается
      > Тесты проводились на:
      > * ОС - `6.1.71-1-MANJARO`.
      > * Процессор - `11th Gen Intel(R) Core(TM) i7-11800H @ 2.30GHz`.
      > * Размер `L1d` - `384 Kib`


3. Возможность выбирать паттерны поведения котов
    * Отражение от стенок с потерей скорости
        * `MOVE_PATTERN_PHIS`
    * Изменения направления и скорости движения при столкновении со стенкой
        * `MOVE_PATTERN_LINE`
    * Случайное перемещение в рамках 'MOVE_RADIUS'
        * `MOVE_PATTERN_RANDOM`


### Фичи второй части

1. "**Вид от третьего лица**"
	> За **любимыми** котами наблюдает дрон.

	**Режимы**:
	* Фокусировка на **любимых** котах -- **любимые** коты имеют "сектор обзора", направленный по ходу движения. Яркими цветами выделяются **остальные** коты, которые попадают в этот сектор.
		> Дрон примерно предсказывает кого видит каждый **любимый** кот. Пририсовывает коту линии обзора (две белые линии), ограничивающее сектор обзора.
	* Отсутствие фокусировки -- **любимые** коты имеют отличительную окраску *(чтоб можно было понять, какие коты являются **остальными**)*
		> Дрон выделяет **любимых** котов.
2. "**Логирование любимых котов**"
	> Дрон печатает в `stdout` пользовательского терминала взаимодействия **любимых** котов (если они дерутся с кем-то или шипят на кого-то)

	**Режимы**:
	* Включено
	* Выключен
1. "**Сложное появление котов**"
	> Дрон мониторит ограниченную область двора. Двор окружен невысоким забором. Подходя к забору кот может решить выпрыгнуть за забор или остаться внутри него. При этом **любимые** коты воспитанные, поэтому они не выходят за забор *(думаете почему еще они **любимые**)*.

	**Описание**:
	* Попадая на границу, кот из категории "**остальные**" может исчезнуть или остаться внутри наблюдаемой области.
	* Спустя какое-то *(нефиксированное)* время кот может появиться на какой-то другой границе.
		> При этом сохраняется физика перемещения за границами наблюдаемой области. Поддерживается гарантия существования хотя бы одного пути за пределами поля, по которому конкретный кот может попасть от одной границы до другой границы с учетом его скорости и прошедшего с момента исчезновения времени.

	**Режимы**:
	* Включен
	* Выключен

## Для пользователей

### Настройка

```bash
rye sync && rye run pre-commit install
```

### Запуск

```bash
rye run python -m src.catsim
```

> На текущий момент настройка параметров запуска происходит только через конфигурационный
> файл (`run_config.py`)
>
> **Пример:**
> ```python
> PLATE_WIDTH, PLATE_HEIGHT = 2000, 2000
> CATS_N = 500000
> ...
> ```

### Запуск тестов

```bash
rye test
```

### Примеры запуска demo
**todo**

### Описание возможных настроек
**todo**

---

## Лицензия

Код распространяется под лицензией MIT. Подробнее в файле [LICENCE](./LICENCE).
